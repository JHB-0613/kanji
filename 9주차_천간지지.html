<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9ì£¼ì°¨ ì²œê°„ê³¼ ì§€ì§€ ì‹¬í™” í€´ì¦ˆ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .week-navigation { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .week-navigation a.btn, .mode-btn { padding: 10px 18px; font-size: 1em; color: white; background-color: #1a5276; border: none; border-radius: 5px; text-decoration: none; font-weight: bold; cursor: pointer; }
        .week-navigation a.btn:hover, .mode-btn:hover { background-color: #154060; }
        
        .mode-selection { text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #ddd; }
        .mode-btn { background-color: #5bc0de; margin: 0 5px; }
        .mode-btn.active { background-color: #007bff; }

        .question-box { background-color: #e9f7ff; border: 1px solid #cceeff; padding: 20px; margin-bottom: 20px; border-radius: 8px; min-height: 200px; }
        .question-box h2 { font-size: 2.5em; text-align: center; color: #007bff; margin-top: 0; margin-bottom: 15px; }
        .question-text { text-align: center; font-size: 1.2em; margin-bottom: 20px; }

        .input-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .input-group input { padding: 10px; font-size: 1.1em; border: 2px solid #ccc; border-radius: 5px; width: 120px; text-align: center; }
        .input-group button { padding: 10px 20px; font-size: 1.1em; background-color: #5cb85c; color: white; border: none; border-radius: 5px; cursor: pointer; }
        
        .result { margin-top: 15px; padding: 15px; border-radius: 5px; display: none; text-align: center; }
        .correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .controls { display: flex; justify-content: space-between; margin-top: 30px; }
        .controls button { padding: 10px 25px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .controls button:disabled { background-color: #ccc; cursor: not-allowed; }
        .progress { text-align: center; margin-bottom: 20px; font-weight: bold; color: #4a90e2; }

        /* ê°„ì§€ ê³„ì‚° í€´ì¦ˆ ì „ìš© ìŠ¤íƒ€ì¼ */
        .ganji-inputs { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .ganji-label { font-weight: bold; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <div class="week-navigation">
        <a href="index.html" class="btn">ğŸ  ì „ì²´ í€´ì¦ˆ ëª©ë¡ (index.html)</a>
    </div>

    <div class="mode-selection">
        <button class="mode-btn active" onclick="switchMode('basic')">ê¸°ë³¸ í€´ì¦ˆ (ëœ»/ìŒ)</button>
        <button class="mode-btn" onclick="switchMode('cycle')">ğŸ”„ ì—°ë„ ê³„ì‚° í€´ì¦ˆ (ì „/í›„)</button>
    </div>

    <h1 id="quizTitle" style="text-align: center; color: #4a90e2;">9ì£¼ì°¨ ì²œê°„(å¤©å¹²)ê³¼ ì§€ì§€(åœ°æ”¯) í€´ì¦ˆ ğŸŒŒ</h1>
    
    <div class="progress" id="progress"></div>
    <div class="question-box" id="questionBox"></div>
    
    <div class="controls">
        <button id="prevBtn" onclick="prevQuestion()">ì´ì „</button>
        <button id="nextBtn" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
        <button id="retryBtn" onclick="startQuiz()" style="display:none;">ë‹¤ì‹œ ì‹œì‘</button>
    </div>
</div>

<script>
    // --- ë°ì´í„° ì •ì˜ ---
    const basicQuizData = [
        { hanja: "ç”²", answer: "ê°‘", meaning: "ê°‘ì˜·/ì²«ì§¸ ì²œê°„. ì˜¤í–‰ì€ ëª©(æœ¨), ì–‘(é™½)ì…ë‹ˆë‹¤." },
        { hanja: "ä¹™", answer: "ì„", meaning: "ìƒˆ/ë‘˜ì§¸ ì²œê°„. ì˜¤í–‰ì€ ëª©(æœ¨), ìŒ(é™°)ì…ë‹ˆë‹¤." },
        { hanja: "ä¸™", answer: "ë³‘", meaning: "ë‚¨ë…˜/ì…‹ì§¸ ì²œê°„. ì˜¤í–‰ì€ í™”(ç«), ì–‘(é™½)ì…ë‹ˆë‹¤." },
        { hanja: "ä¸", answer: "ì •", meaning: "ê³ ë¬´ë˜/ë„·ì§¸ ì²œê°„. ì˜¤í–‰ì€ í™”(ç«), ìŒ(é™°)ì…ë‹ˆë‹¤." },
        { hanja: "æˆŠ", answer: "ë¬´", meaning: "ë‹¤ì„¯ì§¸ ì²œê°„. ì˜¤í–‰ì€ í† (åœŸ), ì–‘(é™½)ì…ë‹ˆë‹¤." },
        { hanja: "å·±", answer: "ê¸°", meaning: "ëª¸/ì—¬ì„¯ì§¸ ì²œê°„. ì˜¤í–‰ì€ í† (åœŸ), ìŒ(é™°)ì…ë‹ˆë‹¤." },
        { hanja: "åºš", answer: "ê²½", meaning: "ì¼ê³±ì§¸ ì²œê°„. ì˜¤í–‰ì€ ê¸ˆ(é‡‘), ì–‘(é™½)ì…ë‹ˆë‹¤." },
        { hanja: "è¾›", answer: "ì‹ ", meaning: "ë§¤ìš¸/ì—¬ëŸì§¸ ì²œê°„. ì˜¤í–‰ì€ ê¸ˆ(é‡‘), ìŒ(é™°)ì…ë‹ˆë‹¤." },
        { hanja: "å£¬", answer: "ì„", meaning: "ì•„í™‰ì§¸ ì²œê°„. ì˜¤í–‰ì€ ìˆ˜(æ°´), ì–‘(é™½)ì…ë‹ˆë‹¤." },
        { hanja: "ç™¸", answer: "ê³„", meaning: "ì—´ì§¸ ì²œê°„. ì˜¤í–‰ì€ ìˆ˜(æ°´), ìŒ(é™°)ì…ë‹ˆë‹¤." },
        { hanja: "å­", answer: "ì", meaning: "ì•„ë“¤/ì²«ì§¸ ì§€ì§€. ë : ì¥, ì‹œê°„: 23:00~01:00 (ìì •)." },
        { hanja: "ä¸‘", answer: "ì¶•", meaning: "ì†Œ/ë‘˜ì§¸ ì§€ì§€. ë : ì†Œ, ì‹œê°„: 01:00~03:00." },
        { hanja: "å¯…", answer: "ì¸", meaning: "ë²”/ì…‹ì§¸ ì§€ì§€. ë : í˜¸ë‘ì´, ì‹œê°„: 03:00~05:00." },
        { hanja: "å¯", answer: "ë¬˜", meaning: "í† ë¼/ë„·ì§¸ ì§€ì§€. ë : í† ë¼, ì‹œê°„: 05:00~07:00." },
        { hanja: "è¾°", answer: "ì§„", meaning: "ìš©/ë³„/ë‹¤ì„¯ì§¸ ì§€ì§€. ë : ìš©, ì‹œê°„: 07:00~09:00." },
        { hanja: "å·³", answer: "ì‚¬", meaning: "ë±€/ì—¬ì„¯ì§¸ ì§€ì§€. ë : ë±€, ì‹œê°„: 09:00~11:00." },
        { hanja: "åˆ", answer: "ì˜¤", meaning: "ë‚®/ì¼ê³±ì§¸ ì§€ì§€. ë : ë§, ì‹œê°„: 11:00~13:00 (ì •ì˜¤)." },
        { hanja: "æœª", answer: "ë¯¸", meaning: "ì•„ë‹/ì—¬ëŸì§¸ ì§€ì§€. ë : ì–‘, ì‹œê°„: 13:00~15:00." },
        { hanja: "ç”³", answer: "ì‹ ", meaning: "í¼/ì•„í™‰ì§¸ ì§€ì§€. ë : ì›ìˆ­ì´, ì‹œê°„: 15:00~17:00." },
        { hanja: "é…‰", answer: "ìœ ", meaning: "ë‹­/ì—´ì§¸ ì§€ì§€. ë : ë‹­, ì‹œê°„: 17:00~19:00." },
        { hanja: "æˆŒ", answer: "ìˆ ", meaning: "ê°œ/ì—´í•œì§¸ ì§€ì§€. ë : ê°œ, ì‹œê°„: 19:00~21:00." },
        { hanja: "äº¥", answer: "í•´", meaning: "ë¼ì§€/ì—´ë‘ì§¸ ì§€ì§€. ë : ë¼ì§€, ì‹œê°„: 21:00~23:00." }
    ];

    const cheongan = ['ê°‘', 'ì„', 'ë³‘', 'ì •', 'ë¬´', 'ê¸°', 'ê²½', 'ì‹ ', 'ì„', 'ê³„'];
    const jiji = ['ì', 'ì¶•', 'ì¸', 'ë¬˜', 'ì§„', 'ì‚¬', 'ì˜¤', 'ë¯¸', 'ì‹ ', 'ìœ ', 'ìˆ ', 'í•´'];

    // --- ìƒíƒœ ë³€ìˆ˜ ---
    let currentMode = 'basic'; // 'basic' or 'cycle'
    let questions = [];
    let currentIndex = 0;
    let answeredState = {};

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // --- ëª¨ë“œ ì „í™˜ ---
    function switchMode(mode) {
        currentMode = mode;
        // ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼ ë³€ê²½
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        if(mode === 'basic') document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
        else document.querySelector('.mode-btn:nth-child(2)').classList.add('active');

        startQuiz();
    }

    // --- í€´ì¦ˆ ìƒì„± ë¡œì§ (ì—°ë„ ê³„ì‚°ìš©) ---
    function generateCycleQuestions(count = 10) {
        let generated = [];
        for(let i=0; i<count; i++) {
            let sIdx = Math.floor(Math.random() * 10);
            let jIdx = Math.floor(Math.random() * 12);
            
            // í˜„ì¬ ë…„ë„
            let current = cheongan[sIdx] + jiji[jIdx]; // ì˜ˆ: ê°‘ì

            // ì´ì „ ë…„ë„ (-1)
            let prevS = (sIdx - 1 + 10) % 10;
            let prevJ = (jIdx - 1 + 12) % 12;
            let prev = cheongan[prevS] + jiji[prevJ]; // ì˜ˆ: ê³„í•´

            // ë‹¤ìŒ ë…„ë„ (+1)
            let nextS = (sIdx + 1) % 10;
            let nextJ = (jIdx + 1) % 12;
            let next = cheongan[nextS] + jiji[nextJ]; // ì˜ˆ: ì„ì¶•

            generated.push({
                type: 'cycle',
                question: current + "ë…„", // ê°‘ìë…„
                prevAnswer: prev,
                nextAnswer: next,
                stemIdx: sIdx,
                branchIdx: jIdx
            });
        }
        return generated;
    }

    // --- í€´ì¦ˆ ì‹œì‘ ---
    function startQuiz() {
        if (currentMode === 'basic') {
            questions = shuffleArray([...basicQuizData]);
            document.getElementById('quizTitle').innerText = "9ì£¼ì°¨ ì²œê°„(å¤©å¹²)ê³¼ ì§€ì§€(åœ°æ”¯) í€´ì¦ˆ ğŸŒŒ";
        } else {
            questions = generateCycleQuestions(10); // 10ë¬¸ì œ ìƒì„±
            document.getElementById('quizTitle').innerText = "ğŸ”„ ìœ¡ì‹­ê°‘ì ì „í›„ ë…„ë„ ë§ì¶”ê¸° í€´ì¦ˆ";
        }
        
        currentIndex = 0;
        answeredState = {};
        
        document.getElementById('retryBtn').style.display = 'none';
        document.getElementById('prevBtn').style.display = 'block';
        document.getElementById('nextBtn').style.display = 'block';
        
        loadQuestion();
    }

    // --- ë¬¸ì œ ë¡œë“œ ---
    function loadQuestion() {
        const total = questions.length;
        if (currentIndex < 0) currentIndex = 0;
        if (currentIndex >= total) {
            showResults();
            return;
        }

        const q = questions[currentIndex];
        const state = answeredState[currentIndex] || { answered: false, correct: false, input: '' };
        const checkButton = state.answered ? '' : `<button onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>`;
        const inputDisabled = state.answered ? 'disabled' : '';

        const box = document.getElementById('questionBox');
        
        if (currentMode === 'basic') {
            // ê¸°ë³¸ í€´ì¦ˆ UI
            box.innerHTML = `
                <h2>${q.hanja}</h2>
                <div class="input-group">
                    <input type="text" id="answerInput" placeholder="ìŒ ì…ë ¥" value="${state.input}" onkeypress="if(event.key==='Enter') checkAnswer()" ${inputDisabled}>
                    ${checkButton}
                </div>
                <div class="result ${state.answered ? (state.correct ? 'correct' : 'incorrect') : ''}" style="display: ${state.answered ? 'block' : 'none'};">
                    ${state.answered ? (state.correct ? 'âœ… <b>ì •ë‹µ!</b>' : `âŒ <b>ì˜¤ë‹µ!</b> ì •ë‹µ: ${q.answer}`) : ''}
                    <br><br>${q.meaning}
                </div>
            `;
            if (!state.answered) setTimeout(() => document.getElementById('answerInput').focus(), 10);

        } else {
            // ì—°ë„ ê³„ì‚° í€´ì¦ˆ UI
            let prevInputVal = state.input ? state.input.prev : '';
            let nextInputVal = state.input ? state.input.next : '';

            box.innerHTML = `
                <div class="question-text">
                    ì˜¬í•´ê°€ <strong style="color:#007bff; font-size:1.5em;">${q.question}</strong>ì´ë¼ë©´,<br>
                    ê·¸ <strong>ì „ í•´</strong>ì™€ <strong>ë‹¤ìŒ í•´</strong>ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
                </div>
                <div class="input-group ganji-inputs">
                    <div>
                        <span class="ganji-label">â—€ ì „ í•´</span><br>
                        <input type="text" id="prevInput" placeholder="ì˜ˆ: ê°‘ì" value="${prevInputVal}" ${inputDisabled}>
                    </div>
                    <div style="font-size:1.5em;">â†”</div>
                    <div>
                        <span class="ganji-label">ë‹¤ìŒ í•´ â–¶</span><br>
                        <input type="text" id="nextInput" placeholder="ì˜ˆ: ë³‘ì¸" value="${nextInputVal}" onkeypress="if(event.key==='Enter') checkAnswer()" ${inputDisabled}>
                    </div>
                </div>
                <div style="text-align:center; margin-top:10px;">${checkButton}</div>
                
                <div class="result ${state.answered ? (state.correct ? 'correct' : 'incorrect') : ''}" style="display: ${state.answered ? 'block' : 'none'};">
                    ${state.answered ? getCycleResultHtml(q, state.correct) : ''}
                </div>
            `;
            if (!state.answered) setTimeout(() => document.getElementById('prevInput').focus(), 10);
        }
        
        updateControls();
    }

    function getCycleResultHtml(q, isCorrect) {
        if (isCorrect) {
            return `âœ… <b>ì •ë‹µì…ë‹ˆë‹¤!</b><br>(${q.prevAnswer}ë…„) â† (${q.question}) â†’ (${q.nextAnswer}ë…„)`;
        } else {
            return `âŒ <b>ì•„ì‰½ë„¤ìš”.</b><br>
                    ì •ë‹µ: <b>ì „ í•´: ${q.prevAnswer}</b>, <b>ë‹¤ìŒ í•´: ${q.nextAnswer}</b><br>
                    (${q.prevAnswer}ë…„) â† (${q.question}) â†’ (${q.nextAnswer}ë…„)`;
        }
    }

    // --- ì •ë‹µ í™•ì¸ ---
    function checkAnswer() {
        const q = questions[currentIndex];
        let isCorrect = false;
        let userInput = '';

        if (currentMode === 'basic') {
            const inputEl = document.getElementById('answerInput');
            userInput = inputEl.value.trim();
            isCorrect = (userInput === q.answer);
            answeredState[currentIndex] = { answered: true, correct: isCorrect, input: userInput };
            inputEl.disabled = true;
        } else {
            const prevEl = document.getElementById('prevInput');
            const nextEl = document.getElementById('nextInput');
            const uPrev = prevEl.value.trim().replace(/ë…„$/, ''); // 'ê°‘ìë…„' ì…ë ¥ ì‹œ 'ê°‘ì'ë¡œ ì²˜ë¦¬
            const uNext = nextEl.value.trim().replace(/ë…„$/, '');
            
            // ë‘˜ ë‹¤ ë§ì•„ì•¼ ì •ë‹µ ì²˜ë¦¬
            isCorrect = (uPrev === q.prevAnswer && uNext === q.nextAnswer);
            
            userInput = { prev: prevEl.value, next: nextEl.value };
            answeredState[currentIndex] = { answered: true, correct: isCorrect, input: userInput };
            
            prevEl.disabled = true;
            nextEl.disabled = true;
        }

        // ë²„íŠ¼ ìˆ¨ê¹€ ë° ê²°ê³¼ í‘œì‹œ
        const btn = document.querySelector('.input-group button') || document.querySelector('.question-box button'); // selector fallback
        if(btn) btn.style.display = 'none';
        
        loadQuestion(); // í™”ë©´ ê°±ì‹  (ê²°ê³¼ í‘œì‹œ í¬í•¨)
    }

    // --- ë‚´ë¹„ê²Œì´ì…˜ ---
    function nextQuestion() {
        if (currentIndex < questions.length - 1) {
            currentIndex++;
            loadQuestion();
        } else if (answeredState[currentIndex]?.answered) {
            showResults();
        }
    }

    function prevQuestion() {
        if (currentIndex > 0) {
            currentIndex--;
            loadQuestion();
        }
    }

    function updateControls() {
        document.getElementById('progress').innerText = `ì§„í–‰ë¥ : ${currentIndex + 1} / ${questions.length}`;
        document.getElementById('prevBtn').disabled = currentIndex === 0;
        
        const isAnswered = answeredState[currentIndex]?.answered;
        const nextBtn = document.getElementById('nextBtn');
        
        if (currentIndex === questions.length - 1) {
            nextBtn.innerText = isAnswered ? 'ê²°ê³¼ ë³´ê¸°' : 'ì •ë‹µ í™•ì¸ í•„ìš”';
            nextBtn.disabled = !isAnswered;
        } else {
            nextBtn.innerText = 'ë‹¤ìŒ ë¬¸ì œ';
            nextBtn.disabled = false;
        }
    }

    function showResults() {
        const score = Object.values(answeredState).filter(s => s.correct).length;
        document.getElementById('questionBox').innerHTML = `
            <h2>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ!</h2>
            <p style="font-size:1.2em; text-align:center;">
                ì´ ${questions.length} ë¬¸ì œ ì¤‘ <b>${score}</b> ê°œë¥¼ ë§íˆì…¨ìŠµë‹ˆë‹¤.
            </p>
        `;
        document.getElementById('prevBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('retryBtn').style.display = 'block';
    }

    // ì´ˆê¸° ì‹¤í–‰
    window.onload = startQuiz;
</script>

</body>
</html>
